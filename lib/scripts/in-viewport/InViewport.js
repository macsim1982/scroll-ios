"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),require("core-js/modules/es7.symbol.async-iterator"),require("core-js/modules/es6.symbol"),require("core-js/modules/es6.number.constructor"),require("core-js/modules/es6.object.assign");var _constants=require("./constants"),_helpers=require("../base/helpers");function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var keyCounter=0,allInstances=[],hasEvents=!1,hasEventToggler=!1,offsetTop=2,offsetBottom=2,offsetLeft=0,offsetRight=0,timer=-1,InViewport=/*#__PURE__*/function(){function a(b){_classCallCheck(this,a),this.key=_constants.NAMESPACE+_constants.SEPARATOR+keyCounter,this.options=Object.assign({},_constants.DEFAULT_OPTIONS,b),this.context="window"===this.options.context?document.body:this.options.context,this.options.element&&!allInstances[this.key]&&(allInstances[this.key]=this,this.bindEvents(),this.refresh(),keyCounter++)}return _createClass(a,[{key:"bindEvents",value:function a(){hasEvents||(// if (!hasEventToggler)
//     this.context.addEventListener('click', this.toggleEvents, false);
this.debouncedResize=(0,_helpers.debounced)(200,this.onResize.bind(this)),this.throttledScroll=(0,_helpers.throttled)(10,this.onScroll.bind(this)),this.toggleEvents=this.toggleEvents.bind(this),window.addEventListener("resize",this.debouncedResize,!1),this.context.addEventListener("scroll",this.throttledScroll,!1),hasEvents=!0,hasEventToggler=!0)}},{key:"unbindEvents",value:function a(){hasEvents&&(window.removeEventListener("resize",this.debouncedResize,!1),this.context.removeEventListener("scroll",this.throttledScroll,!1),hasEvents=!1)}},{key:"toggleEvents",value:function a(){hasEvents?this.unbindEvents():this.bindEvents()}// EVENTS
},{key:"onChange",value:function d(a,b,c){if(this.options.element.classList[1===b?"add":"remove"](_constants.NAMESPACE+"--"+a),this.options.element&&!this.isAnimating)for(var e in c)this.entering(c,e),this.leaving(c,e)}},{key:"onResize",value:function a(){window.requestAnimationFrame(this.refreshAll)}},{key:"onScroll",value:function a(){window.requestAnimationFrame(this.refreshAll)}// Methods
},{key:"addClassAndRemoveOnAnimationEnd",value:function f(a,b){var c=this,d=this.options.element;this.isAnimating=!0,d.classList.add(a);// TODO: can be done in a better way !!
var e=setTimeout(function(){d.classList.remove(a),c.isAnimating=!1,clearTimeout(e)},b)}},{key:"getRect",value:function e(a,b){var c=a.getBoundingClientRect(),d={top:c.top,left:c.left,bottom:c.bottom,right:c.right,width:c.width,height:c.height};return b&&(d={top:c.top+offsetTop,left:c.left+offsetLeft,bottom:c.bottom-offsetBottom,right:c.right-offsetRight,width:d.width,height:d.height}),d}},{key:"insideViewport",value:function b(c,a){return+(c.top>=a.top&&c.bottom<=a.bottom&&c.left>=a.left&&c.right<=a.right)}},{key:"acrossViewport",value:function b(c,a){return+(c.top<a.bottom&&c.bottom>a.top&&c.left<a.right&&c.right>a.left)}},{key:"getViewport",value:function r(a){var b=this.ctxRect.left,c=this.ctxRect.width,d=this.ctxRect.top,e=this.ctxRect.height,f=this.elRect.left,g=this.elRect.width,h=this.elRect.top,i=this.elRect.height,j=d>h+i&&1===a.any,k=b>f+g&&1===a.any,l=h>d+e&&1===a.any,m=f>b+c&&1===a.any,n=d<=h+i&&0===a.any,o=b<=f+g&&0===a.any,p=h<=d+e&&0===a.any,q=f<=b+c&&0===a.any;return{top:[n,j],left:[o,k],bottom:[p,l],right:[q,m]}}},{key:"enterinOrLeaving",value:function g(a,b,c){var d=["enter-from","leave-to"],e=["enter","leave"],f=1===c?0:1;a[b][f]&&(this.addClassAndRemoveOnAnimationEnd(_constants.NAMESPACE+"--"+d[c]+"-"+b,_constants.CSS_ENTER_DURATI0N),this.options[e[c]]&&"function"==typeof this.options[e[c]]&&this.options[e[c]](d[c]+"-"+b,this))}},{key:"entering",value:function c(a,b){this.enterinOrLeaving(a,b,1)}},{key:"leaving",value:function c(a,b){this.enterinOrLeaving(a,b,0)}},{key:"refresh",value:function f(){var a=this.context,b=this.options.element,c=this.getRect(b),d=this.getRect(a,!0),e={all:this.insideViewport(c,d),any:this.acrossViewport(c,d)};if("object"===_typeof(this.obj)&&this.obj.any!==e.any){var g=this.getViewport(e);this.onChange("any",e.any,g)}else 1===e.any&&this.options.element.classList.add(_constants.NAMESPACE+"--any");return this.elRect=c,this.ctxRect=d,this.obj=Object.assign({},e),e}},{key:"refreshAll",value:function b(){a.refreshAll()}}],[{key:"refreshAll",value:function b(){var a=allInstances;for(var c in a)c&&a[c].refresh()}}]),a}();exports.default=InViewport;